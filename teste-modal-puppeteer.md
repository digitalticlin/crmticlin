# üß™ TESTE DA JORNADA COMPLETA - PUPPETEER IMPORT MODAL\n\n## üìã **CHECKLIST DE VERIFICA√á√ÉO**\n\n### ‚úÖ **1. ESTRUTURA VPS**\n- [x] Servidor Puppeteer rodando na porta 3001\n- [x] QR Code sendo gerado com sucesso (8k+ chars base64)\n- [x] Token de autentica√ß√£o configurado\n- [x] Endpoints funcionando: `/start-import`, `/session-status`, `/health`\n\n### ‚úÖ **2. EDGE FUNCTION**\n- [x] Handler `importPuppeteerHandler.ts` configurado\n- [x] Service `puppeteerService.ts` com comunica√ß√£o VPS\n- [x] Tabela `instances_puppeteer` criada no Supabase\n- [x] Webhook para receber progresso da VPS\n\n### ‚úÖ **3. INTERFACE MODAL**\n- [x] `PuppeteerImportModal.tsx` implementado\n- [x] `ImportHistoryButton.tsx` integrado ao `SimpleInstanceCard`\n- [x] Polling autom√°tico para atualiza√ß√µes (3s)\n- [x] Estados: loading ‚Üí QR ‚Üí connected ‚Üí importing ‚Üí completed\n\n## üöÄ **TESTE MANUAL**\n\n### **Passo 1: Abrir Settings ‚Üí WhatsApp**\n1. Ir para a p√°gina de Settings\n2. Clicar na aba \"WhatsApp\"\n3. Localizar uma inst√¢ncia conectada\n4. Verificar se aparece o bot√£o \"Importar Hist√≥rico\"\n\n### **Passo 2: Clicar em \"Importar Hist√≥rico\"**\n1. Modal deve abrir automaticamente\n2. Deve aparecer \"Gerando QR Code...\" com loading\n3. Edge Function deve ser chamada: `/whatsapp_chat_import`\n4. VPS deve receber requisi√ß√£o no endpoint `/start-import`\n\n### **Passo 3: QR Code deve aparecer**\n1. Loading deve parar\n2. QR Code deve aparecer em formato base64\n3. Status deve mostrar \"Aguardando escaneamento\"\n4. Instru√ß√µes de como escanear devem aparecer\n\n### **Passo 4: Escanear QR Code**\n1. Usar celular para escanear\n2. VPS deve detectar conex√£o\n3. Status deve mudar para \"Conectado com sucesso!\"\n4. Bot√£o \"Iniciar Importa√ß√£o\" deve aparecer\n\n### **Passo 5: Iniciar Importa√ß√£o**\n1. Clicar em \"Iniciar Importa√ß√£o\"\n2. Status deve mudar para \"Importando\"\n3. Barra de progresso deve aparecer\n4. Contadores de contatos/mensagens devem atualizar\n\n### **Passo 6: Finalizar**\n1. Progresso deve chegar a 100%\n2. Status deve mudar para \"Conclu√≠do\"\n3. Resumo final deve aparecer\n4. Op√ß√£o de fechar modal deve estar dispon√≠vel\n\n## üîß **COMANDOS DE DEBUG**\n\n### **VPS (31.97.163.57)**\n```bash\n# Verificar logs do servidor\njournalctl -u whatsapp-puppeteer.service -f\n\n# Status do servi√ßo\nsystemctl status whatsapp-puppeteer\n\n# Testar endpoint diretamente\ncurl -X POST http://localhost:3001/start-import \\\n  -H \"Authorization: Bearer 8bb0c4f8a89d254783d693050ecd7ff4878534f46a87ece12b24f506548ce430\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"instanceId\":\"teste\",\"instanceName\":\"Teste\",\"webhookUrl\":\"https://example.com\"}'\n```\n\n### **Frontend (Browser DevTools)**\n```javascript\n// Verificar logs do modal\nconsole.log('[Puppeteer Modal] logs');\n\n// Verificar dados da sess√£o\nconst session = /* dados do state */;\nconsole.log(session);\n\n// Testar Edge Function diretamente\nsupabase.functions.invoke('whatsapp_chat_import', {\n  body: {\n    action: 'import_via_puppeteer',\n    instanceId: 'test-id',\n    userValidation: {\n      createdByUserId: 'user-id',\n      instanceName: 'Test Instance'\n    }\n  }\n});\n```\n\n### **Supabase (Database)**\n```sql\n-- Verificar sess√µes criadas\nSELECT * FROM instances_puppeteer ORDER BY created_at DESC LIMIT 5;\n\n-- Verificar QR codes\nSELECT session_id, status, LENGTH(qr_code) as qr_size, created_at \nFROM instances_puppeteer \nWHERE qr_code IS NOT NULL;\n\n-- Verificar progresso\nSELECT session_id, status, progress, total_contacts, total_messages, updated_at\nFROM instances_puppeteer \nORDER BY updated_at DESC;\n```\n\n## üéØ **PR√ìXIMOS PASSOS**\n\n1. **Testar a jornada completa** seguindo os passos acima\n2. **Verificar se QR code aparece** no modal\n3. **Confirmar se polling funciona** (atualiza√ß√µes autom√°ticas)\n4. **Testar escaneamento** com celular real\n5. **Verificar se importa√ß√£o processa** dados corretamente\n\n## üîç **PONTOS DE ATEN√á√ÉO**\n\n- **Token VPS**: Certificar que `VPS_PUPPETEER_IMPORT` est√° nos secrets\n- **Polling**: Modal deve atualizar automaticamente a cada 3s\n- **QR Code**: Deve aparecer como imagem PNG base64\n- **Webhook**: VPS deve notificar progresso para Edge Function\n- **Cleanup**: Sess√µes antigas devem ser limpas automaticamente 