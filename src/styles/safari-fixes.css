/* Safari & WebKit Specific Fixes - TODAS VERSÕES MACOS */

/* IMPORTANTE: Aplica fixes para TODOS os Macs (antigos e novos) */
/* Classes aplicadas via JavaScript para detecção precisa */

/* === GLASSMORPHISM FIXES PARA TODOS OS MACS === */
body.macos-system .backdrop-blur-sm,
body.safari-browser .backdrop-blur-sm,
body.webkit-browser.macos-system .backdrop-blur-sm {
  background-color: rgba(255, 255, 255, 0.92) !important;
  -webkit-backdrop-filter: blur(4px) saturate(180%);
  backdrop-filter: blur(4px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.18);
}

body.macos-system .backdrop-blur,
body.safari-browser .backdrop-blur,
body.webkit-browser.macos-system .backdrop-blur {
  background-color: rgba(255, 255, 255, 0.93) !important;
  -webkit-backdrop-filter: blur(6px) saturate(180%);
  backdrop-filter: blur(6px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

body.macos-system .backdrop-blur-md,
body.safari-browser .backdrop-blur-md,
body.webkit-browser.macos-system .backdrop-blur-md {
  background-color: rgba(255, 255, 255, 0.95) !important;
  -webkit-backdrop-filter: blur(8px) saturate(180%);
  backdrop-filter: blur(8px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.25);
}

body.macos-system .backdrop-blur-lg,
body.safari-browser .backdrop-blur-lg,
body.webkit-browser.macos-system .backdrop-blur-lg {
  background-color: rgba(255, 255, 255, 0.96) !important;
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  backdrop-filter: blur(12px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

/* Fallback APENAS quando backdrop-filter falha completamente NO SAFARI */
body.safari-browser.no-backdrop-support [class*="backdrop-blur"],
body.safari-browser.backdrop-render-fail [class*="backdrop-blur"] {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background-color: rgba(255, 255, 255, 0.98) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

/* Fix para containers específicos do funil de vendas APENAS NO SAFARI */
body.safari-browser .sticky.top-0.backdrop-blur-md,
body.webkit-browser.macos-system .sticky.top-0.backdrop-blur-md {
  background: linear-gradient(
    to bottom,
    rgba(255, 255, 255, 0.98),
    rgba(255, 255, 255, 0.96)
  ) !important;
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.8);
}

/* Detecta APENAS Safari no macOS - não afeta Windows/Chrome/Firefox */
@supports (-webkit-appearance: none) and (stroke-color: transparent) {
  @media screen and (max-resolution: 192dpi) and (min-color-index: 0) {
    /* Aplicar SOMENTE se for Safari no macOS */
    body.safari-browser .sticky.backdrop-blur-md,
    body.macos-system .sticky.backdrop-blur-md {
      background-color: rgba(255, 255, 255, 0.98) !important;
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
    }

    body.safari-browser .backdrop-blur-md,
    body.macos-system .backdrop-blur-md {
      background-color: rgba(255, 255, 255, 0.95) !important;
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
    }

    body.safari-browser .backdrop-blur-lg,
    body.macos-system .backdrop-blur-lg {
      background-color: rgba(255, 255, 255, 0.96) !important;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }

    /* Fix geral APENAS para Safari */
    body.safari-browser [class*="backdrop-blur"] {
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
      will-change: transform;
    }
  }
}

/* iOS Safari específico - não afeta desktop */
@supports (-webkit-touch-callout: none) {
  body.ios-system .backdrop-blur-sm,
  body.ios-system .backdrop-blur,
  body.ios-system .backdrop-blur-md,
  body.ios-system .backdrop-blur-lg {
    -webkit-backdrop-filter: blur(8px) brightness(1.1);
    backdrop-filter: blur(8px) brightness(1.1);
    background-color: rgba(255, 255, 255, 0.92);
  }
}

/* Performance optimization APENAS para Safari identificado */
body.safari-browser .backdrop-blur-3xl {
  -webkit-backdrop-filter: blur(24px);
  backdrop-filter: blur(24px);
}

body.safari-browser .backdrop-blur-2xl {
  -webkit-backdrop-filter: blur(20px);
  backdrop-filter: blur(20px);
}

body.safari-browser .backdrop-blur-xl {
  -webkit-backdrop-filter: blur(16px);
  backdrop-filter: blur(16px);
}

body.safari-browser .backdrop-blur-lg {
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}

body.safari-browser .backdrop-blur-md {
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
}

body.safari-browser .backdrop-blur-sm {
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
}

body.safari-browser .backdrop-blur {
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
}

/* === MODAIS FIXES PARA TODOS OS MACS === */

/* Fix crítico: Modais fora do viewport em TODOS OS MACS */
body.macos-system .fixed.left-\[50\%\].top-\[50\%\],
body.safari-browser .fixed.left-\[50\%\].top-\[50\%\],
body.macos-backdrop-issues .fixed.left-\[50\%\].top-\[50\%\],
body.safari-modal-issues .fixed.left-\[50\%\].top-\[50\%\] {
  /* Forçar compositing layer para melhor renderização */
  transform: translate(-50%, -50%) translateZ(0) !important;
  -webkit-transform: translate(-50%, -50%) translateZ(0) !important;
  will-change: transform;

  /* Garantir z-index alto para modais */
  z-index: 9999 !important;

  /* Fix para overflow em Macs antigos */
  max-height: calc(100vh - 40px);
  max-width: calc(100vw - 40px);
}

/* Fix específico para DialogContent do Radix UI */
body.macos-system [data-radix-dialog-content],
body.safari-browser [data-radix-dialog-content],
body.macos-backdrop-issues [data-radix-dialog-content] {
  transform: translate(-50%, -50%) translateZ(0) !important;
  -webkit-transform: translate(-50%, -50%) translateZ(0) !important;
  will-change: transform;
  position: fixed !important;
  left: 50% !important;
  top: 50% !important;
  z-index: 9999 !important;
}

/* Fix para overlay de modais */
body.macos-system [data-radix-dialog-overlay],
body.safari-browser [data-radix-dialog-overlay],
body.macos-backdrop-issues [data-radix-dialog-overlay] {
  position: fixed !important;
  inset: 0 !important;
  z-index: 9998 !important;
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
}

/* === GLASSMORPHISM SHADOWS PARA TODOS OS MACS === */
body.macos-system .shadow-glass,
body.safari-browser .shadow-glass,
body.webkit-browser.macos-system .shadow-glass {
  box-shadow:
    0 8px 24px rgba(0, 0, 0, 0.08),
    0 0 0 1px rgba(255, 255, 255, 0.8),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
  /* Forçar compositing para melhor performance */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: transform;
}

body.macos-system .shadow-glass-lg,
body.safari-browser .shadow-glass-lg,
body.webkit-browser.macos-system .shadow-glass-lg {
  box-shadow:
    0 12px 32px rgba(0, 0, 0, 0.1),
    0 0 0 1px rgba(255, 255, 255, 0.85),
    inset 0 1px 0 rgba(255, 255, 255, 0.95);
  /* Forçar compositing para melhor performance */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: transform;
}

/* === PERFORMANCE FIXES PARA MACS ANTIGOS === */
body.macos-version-9 [class*="backdrop-blur"],
body.macos-version-10 [class*="backdrop-blur"],
body.macos-version-11 [class*="backdrop-blur"],
body.macos-version-12 [class*="backdrop-blur"] {
  /* Reduzir blur para Macs antigos (melhor performance) */
  -webkit-backdrop-filter: blur(6px) !important;
  backdrop-filter: blur(6px) !important;
  /* Background mais sólido para compensar */
  background-color: rgba(255, 255, 255, 0.97) !important;
}