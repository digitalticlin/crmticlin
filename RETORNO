[Webhook] ✅ Processamento concluído: { success: true, message: "Message processed with optimized direct flow", data: { mediaProcessed: false, usedDirectFlow: true, architecture: "RPC + Edge + WebSocket" } }
[Webhook] 📝 Mensagem de texto - sem processamento de mídia necessário
[Webhook] ✅ Mensagem salva: 1c9b3028-0972-47be-8fa5-11f300a3a80c
[Webhook] 📊 RPC RESULT: { hasError: false, errorMessage: undefined, errorDetails: undefined, errorHint: undefined, errorCode: undefined, hasResult: true, resultType: "object", resultKeys: [ "lead_id", "success", "message_id", "file_extension" ], resultSuccess: true, resultError: undefined, media_processing: undefined, full_result: { lead_id: "cbed9f4b-2033-430c-8772-104bfcae4efd", success: true, message_id: "1c9b3028-0972-47be-8fa5-11f300a3a80c", file_extension: null } }
[Webhook] ✅ Profile pic convertida para base64 (64515 chars)
[Webhook] 📤 Mídia processada: { tipo: "document", tamanho: 0, mimeType: "application/pdf", hasBase64: false, base64Preview: "NULL" }
[Webhook] 🚀 Chamando RPC save_received_message_webhook...
[Webhook] 🎯 Funil da instância: { instanceId: "digitalticlingmailcom", funnelId: "c018b005-f15a-4374-a054-d28a1c9596d2", hasInstanceFunnel: true }
[Webhook] ✅ UUID do usuário encontrado: 712e7708-2299-4a00-9128-577c8f113ca4
[Webhook] 📥 Baixando profile pic da URL: https://pps.whatsapp.net/v/t61.24694-24/534422048_...
[Webhook] 🔍 Detectando tipo de mídia: { originalType: "document", mimeType: undefined, fileName: undefined, hasBase64: false }
[Webhook] 📨 Processando mensagem com infraestrutura existente: { instanceId: "digitalticlingmailcom", hasMessage: true, fromMe: undefined, messageType: "document", hasMediaData: false, hasCaption: false }
[Webhook] 🔍 Buscando UUID da instância: digitalticlingmailcom
[Webhook] ✅ Tipo original válido: document
[Webhook] 🎵 DEBUG MÍDIA - Campos de mídia encontrados: { mediaBase64_root: false, mediabase64_root: false, base64Data_root: false, mediaData_root: false, media_root: false, buffer_root: false, content_root: false, data_buffer: false, data_base64: false, data_mediaData: false, data_mediaBase64: false, message_media: false }
[Webhook] 🎵 DEBUG MÍDIA - data keys: [ "messageId", "body", "from", "fromMe", "timestamp", "messageType", "senderProfileName", "profile_pic_url", "mediaUrl" ]
[Webhook] 🎵 DEBUG MÍDIA - Payload completo (primeiras chaves): [ "event", "instanceId", "instanceName", "from", "fromMe", "messageType", "message", "timestamp", "createdByUserId", "data" ]
[Webhook] 🎵 DEBUG MÍDIA - messageType: document
[Webhook] 🔄 Processando evento: { event: "message_received", instanceId: "digitalticlingmailcom", hasMessage: true, hasMediaData: false, timestamp: "2025-10-18T01:39:16.701Z" }
Listening on http://localhost:9999/
[Webhook] 🔑 Webhook secret configurado: false
[Webhook] 🚀 Inicializando webhook WhatsApp Web v3.1 - OTIMIZADO PARA MEMÓRIA
[Webhook] 🔐 Edge Function secret configurada: true